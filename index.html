<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>lvghter — phone music producer</title>
  <meta name="theme-color" content="#0b0713" />
  <meta name="description" content="lvghter — phone-based music producer. Listen on Spotify, follow on socials, and get in touch for collaborations." />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
  <style>
    :root{
      --bg: #0b0713;
      --bg-2: #090513;
      --purple: #7b2cff;
      --accent: #7b2cff;      /* dynamic from artwork */
      --accent-overlay: rgba(123, 44, 255, .18);
      --text: #efeaff;
      --muted: #b9b4d3;
      --card: rgba(255,255,255,0.06);
      --card-brd: rgba(255,255,255,0.12);
      --radius: 16px;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --blur: blur(10px);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; scroll-behavior: smooth; }
    body{
      margin:0;
      font-family: Poppins, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background:
        radial-gradient(1200px 800px at 10% -10%, rgba(123, 44, 255, .25), transparent 60%),
        radial-gradient(1000px 700px at 110% 10%, rgba(123, 44, 255, .18), transparent 60%),
        linear-gradient(180deg, var(--bg), var(--bg-2));
      overflow-x:hidden;
    }

    /* Global dynamic color overlay */
    .dynamic-overlay{
      position: fixed; inset:0; pointer-events:none; z-index:0;
      background: radial-gradient(1200px 800px at 80% 20%, var(--accent-overlay), transparent 65%);
      transition: background 750ms ease;
    }

    /* Top nav */
    .topbar{
      position:sticky; top:0; z-index:100;
      backdrop-filter: saturate(1.2) blur(8px);
      background: linear-gradient(180deg, rgba(10, 7, 18, 0.75), rgba(10,7,18,0.3));
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    .nav{
      max-width: 1200px; margin:0 auto; padding: 14px 18px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text);
    }
    .brand__logo{
      width:36px; height:36px; border-radius:8px;
      background: linear-gradient(135deg, var(--accent), #4b1a99);
      box-shadow: 0 8px 20px rgba(123,44,255,.35), inset 0 0 40px rgba(255,255,255,.06);
    }
    .brand__name{
      font-weight:800; letter-spacing:.5px; font-size:1.1rem;
    }
    .nav__links{
      display:flex; gap:14px; align-items:center;
    }
    .nav__links a{
      color:var(--muted); text-decoration:none; font-weight:500; font-size:.95rem;
      padding:8px 10px; border-radius:10px; transition: color .2s, background .2s;
    }
    .nav__links a:hover{ color:var(--text); background: rgba(255,255,255,0.06); }
    .hamburger{ display:none; background:transparent; color:var(--text); border:0; font-size:1.35rem; }

    /* Mobile menu */
    @media (max-width: 860px){
      .hamburger{ display:block; }
      .nav__links{
        position: fixed; top:58px; right:12px; left:12px; display:none; flex-direction:column;
        background: rgba(10,7,18,.9); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:12px;
      }
      .nav__links.open{ display:flex; }
    }

    /* Hero */
    #hero{
      position:relative; z-index:1;
      max-width:1200px; margin:0 auto; padding: clamp(48px, 10vw, 110px) 18px 40px;
      display:grid; grid-template-columns: 1.1fr .9fr; gap:32px; align-items:center;
    }
    #hero .title{
      font-size: clamp(2.6rem, 7vw, 5rem);
      line-height: .95;
      font-weight: 800;
      letter-spacing: .5px;
      margin:0 0 8px;
      background: linear-gradient(90deg, #fff, #b996ff 40%, var(--accent));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      text-shadow: 0 10px 40px rgba(123,44,255,.25);
    }
    #hero .subtitle{
      color: var(--muted); font-weight: 500; margin-bottom: 26px;
    }
    .ctas{ display:flex; flex-wrap:wrap; gap:12px; }
    .btn{
      appearance:none; border:1px solid transparent; cursor:pointer; color:#100b18;
      padding:12px 16px; border-radius:12px; font-weight:700; letter-spacing:.2px;
      transition: transform .15s ease, box-shadow .2s ease, background .2s;
      background: linear-gradient(135deg, var(--accent), #5928d8); color:white;
      box-shadow: 0 10px 24px rgba(123,44,255,.35);
    }
    .btn:hover{ transform: translateY(-1px); box-shadow: 0 14px 30px rgba(123,44,255,.45);}
    .btn.secondary{ background: transparent; color: var(--text); border-color: rgba(255,255,255,.12);}
    .btn.secondary:hover{ background: rgba(255,255,255,.06); }
    .hero-card{
      background: var(--card); border:1px solid var(--card-brd); border-radius: var(--radius);
      padding:18px; box-shadow: var(--shadow);
      transform: translateZ(0);
    }
    .hero-badge{
      display:inline-flex; gap:8px; align-items:center; color:#d7cff8; font-weight:600;
      background: rgba(123,44,255,.1); border:1px solid rgba(123,44,255,.25);
      border-radius: 999px; padding: 8px 12px; margin-bottom: 10px;
    }
    .hero-list{ list-style:none; margin:12px 0 0; padding:0; display:grid; gap:8px; color:var(--muted); font-size:.95rem;}
    .hero-list i{ color: var(--accent); margin-right:8px; }

    @media (max-width: 920px){
      #hero{ grid-template-columns: 1fr; }
    }

    /* Sections */
    section{ position:relative; z-index:1; }
    .container{ max-width:1200px; margin:0 auto; padding: 18px; }
    .section-title{
      font-size: clamp(1.6rem, 3.5vw, 2.2rem); margin: 12px 0 18px; font-weight:800;
    }
    .muted{ color: var(--muted); }

    /* Music Section */
    .music{
      display:grid; grid-template-columns: 1.1fr .9fr; gap:24px; align-items:start;
    }
    .player-wrap{
      background: var(--card); border:1px solid var(--card-brd); border-radius: var(--radius);
      padding:14px; box-shadow: var(--shadow); position:relative; overflow:hidden;
    }
    .player-wrap .loader{
      position:absolute; inset:0; display:none; place-items:center; background: rgba(10,7,18,.4); backdrop-filter: blur(3px);
    }
    .player-wrap.loading .loader{ display:grid; }
    .spinner{ width:36px; height:36px; border:3px solid rgba(255,255,255,.25); border-top-color: var(--accent); border-radius:50%; animation: spin 1s linear infinite; }
    @keyframes spin{ to { transform: rotate(360deg); } }

    .iframe-ratio{
      position:relative; width:100%; aspect-ratio: 16 / 9; border-radius: 12px; overflow:hidden; margin-bottom: 12px;
    }
    .iframe-ratio iframe{
      position:absolute; inset:0; width:100%; height:100%; border:0; border-radius: 12px; background:#000;
    }

    .input-row{
      display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:10px;
    }
    .input-row input{
      flex:1; min-width: 220px; padding:12px 14px; border-radius: 12px; border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04); color: var(--text); outline:none; transition: border .2s, background .2s;
    }
    .input-row input::placeholder{ color: #9c94bd; }
    .input-row input:focus{ border-color: rgba(123,44,255,.6); background: rgba(255,255,255,.06); }

    .now-playing{
      display:flex; align-items:center; gap:12px; margin-top:10px; color: var(--muted);
    }
    .swatch{
      width:14px; height:14px; border-radius:4px; border:1px solid rgba(255,255,255,.5);
      box-shadow: 0 0 20px var(--accent-overlay);
      background: var(--accent);
    }

    .tracks{
      display:grid; grid-template-columns: repeat(2, 1fr); gap:14px;
    }
    @media (max-width: 860px){ .music{ grid-template-columns: 1fr; } .tracks{ grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 560px){ .tracks{ grid-template-columns: repeat(2, 1fr); } }

    .track{
      position:relative; overflow:hidden; border-radius: 14px; background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.08); cursor:pointer; transition: transform .15s ease, box-shadow .2s;
      min-height: 96px; display:grid; grid-template-columns: 88px 1fr; align-items:center;
    }
    .track:hover{ transform: translateY(-2px); box-shadow: 0 14px 26px rgba(0,0,0,.35); }
    .track__thumb{ width:88px; height:88px; object-fit:cover; }
    .track__body{ padding:10px; }
    .track__title{ font-weight:700; font-size:.95rem; line-height:1.2; margin-bottom:4px; }
    .track__meta{ font-size:.85rem; color: var(--muted); }

    .pill{
      position:absolute; top:8px; right:8px; font-size:.7rem;
      background: rgba(0,0,0,.55); color: #eae0ff; padding:4px 8px; border-radius:999px; border:1px solid rgba(255,255,255,.1);
    }

    /* About & Socials */
    .grid-2{ display:grid; grid-template-columns: 1.1fr .9fr; gap:24px; }
    @media (max-width: 920px){ .grid-2{ grid-template-columns: 1fr; } }

    .card{
      background: var(--card); border:1px solid var(--card-brd); border-radius: var(--radius);
      padding:18px; box-shadow: var(--shadow);
    }
    .socials{ display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; }
    @media (max-width: 560px){ .socials{ grid-template-columns: repeat(2, 1fr); } }

    .social{
      display:flex; gap:12px; align-items:center; padding:12px; border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.04); border-radius: 14px; text-decoration:none; color:var(--text);
      transition: transform .15s ease, background .2s, border .2s; min-height:64px;
    }
    .social:hover{ transform: translateY(-2px); background: rgba(255,255,255,.07); border-color: rgba(255,255,255,.18); }
    .social i{ font-size:1.1rem; width:28px; height:28px; display:grid; place-items:center; color: var(--accent); }
    .social small{ color: var(--muted); display:block; margin-top:2px; }

    /* Footer */
    footer{ margin:32px 0 20px; color: var(--muted); text-align:center; }

    /* Reveal on scroll */
    .reveal{ opacity:0; transform: translateY(14px); transition: opacity .6s ease, transform .6s ease; }
    .reveal.show{ opacity:1; transform: none; }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      * { animation: none !important; transition: none !important; }
    }
  </style>
</head>
<body>
  <div class="dynamic-overlay" aria-hidden="true"></div>

  <header class="topbar">
    <div class="nav">
      <a class="brand" href="#hero" aria-label="lvghter Home">
        <div class="brand__logo"></div>
        <div class="brand__name">lvghter</div>
      </a>
      <nav class="nav__links" id="navLinks" aria-label="Primary">
        <a href="#music">Music</a>
        <a href="#about">About</a>
        <a href="#socials">Socials</a>
        <a href="#contact">Contact</a>
      </nav>
      <button class="hamburger" id="hamburger" aria-label="Toggle menu"><i class="fa-solid fa-bars"></i></button>
    </div>
  </header>

  <main>
    <section id="hero">
      <div>
        <div class="hero-badge"><i class="fa-solid fa-mobile-screen-button"></i> phone music producer</div>
        <h1 class="title">lvghter</h1>
        <p class="subtitle">Beats and vibes made straight from the phone. Minimal setup, maximum sauce.</p>
        <div class="ctas">
          <a class="btn" href="#music"><i class="fa-brands fa-spotify"></i> Listen now</a>
          <a class="btn secondary" href="#contact"><i class="fa-regular fa-paper-plane"></i> Book / collab</a>
        </div>
      </div>
      <div class="hero-card reveal">
        <strong style="display:block; margin-bottom:6px;">What to expect</strong>
        <ul class="hero-list">
          <li><i class="fa-solid fa-bolt"></i>Hard-hitting drums, emotional chords</li>
          <li><i class="fa-solid fa-wand-magic-sparkles"></i>Color-reactive UI from Spotify artwork</li>
          <li><i class="fa-solid fa-mobile"></i>Optimized for mobile, buttery animations</li>
        </ul>
      </div>
    </section>

    <section id="music" class="container">
      <h2 class="section-title">Music</h2>
      <div class="music">
        <!-- Player + controls -->
        <div class="player-wrap reveal" id="playerWrap">
          <div class="iframe-ratio">
            <iframe id="spotifyEmbed" title="Spotify Player" loading="lazy" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>
          </div>

          <div class="now-playing" id="nowPlaying">
            <div class="swatch" id="swatch"></div>
            <div>
              <div style="font-weight:700;">Now playing: <span id="npTitle">—</span></div>
              <div class="muted" style="font-size:.9rem;">by <span id="npArtist">—</span></div>
            </div>
          </div>

          <div class="input-row" style="margin-top:12px;">
            <input id="spotifyInput" type="url" placeholder="Paste a Spotify link (track/album/playlist)" />
            <button class="btn" id="loadBtn"><i class="fa-solid fa-play"></i> Load</button>
            <button class="btn secondary" id="prevBtn" title="Previous"><i class="fa-solid fa-backward-step"></i></button>
            <button class="btn secondary" id="nextBtn" title="Next"><i class="fa-solid fa-forward-step"></i></button>
          </div>

          <div class="loader"><div class="spinner" aria-hidden="true"></div></div>
        </div>

        <!-- Featured tracks grid -->
        <div class="card reveal">
          <h3 style="margin:0 0 10px;">Featured</h3>
          <p class="muted" style="margin-top:0">Tap a tile to play and watch the background adapt to the cover art.</p>
          <div class="tracks" id="tracksGrid" aria-live="polite"></div>
        </div>
      </div>
    </section>

    <section id="about" class="container">
      <div class="grid-2">
        <div class="card reveal">
          <h2 class="section-title">About</h2>
          <p class="muted">
            I’m lvghter — a phone-based music producer crafting beats and melodies on-the-go. From bus rides to late nights, I build tracks with the tools I carry everywhere. Minimal setup. Maximum ideas.
          </p>
          <p class="muted">
            Open to collaborations, custom beats, and sync/licensing. If you vibe with the sound, let’s create something special.
          </p>
        </div>
        <div class="card reveal">
          <h2 class="section-title">Tools & Workflow</h2>
          <ul class="hero-list">
            <li><i class="fa-solid fa-music"></i>DAWs & apps: BandLab, FL Studio Mobile, Koala, GarageBand</li>
            <li><i class="fa-solid fa-drum"></i>Finger drumming, resampling, vocal chops</li>
            <li><i class="fa-solid fa-cloud"></i>Cloud project handoff + stems on request</li>
          </ul>
        </div>
      </div>
    </section>

    <section id="socials" class="container">
      <div class="card reveal">
        <h2 class="section-title">Socials</h2>
        <div class="socials">
          <a class="social" href="https://open.spotify.com/" target="_blank" rel="noopener">
            <i class="fa-brands fa-spotify"></i>
            <div>
              <strong>Spotify</strong>
              <small>Follow and stream</small>
            </div>
          </a>
          <a class="social" href="https://soundcloud.com/" target="_blank" rel="noopener">
            <i class="fa-brands fa-soundcloud"></i>
            <div>
              <strong>SoundCloud</strong>
              <small>Demos & drafts</small>
            </div>
          </a>
          <a class="social" href="https://www.instagram.com/" target="_blank" rel="noopener">
            <i class="fa-brands fa-instagram"></i>
            <div>
              <strong>Instagram</strong>
              <small>Clips & reels</small>
            </div>
          </a>
          <a class="social" href="https://www.tiktok.com/" target="_blank" rel="noopener">
            <i class="fa-brands fa-tiktok"></i>
            <div>
              <strong>TikTok</strong>
              <small>Beat snippets</small>
            </div>
          </a>
          <a class="social" href="https://www.youtube.com/" target="_blank" rel="noopener">
            <i class="fa-brands fa-youtube"></i>
            <div>
              <strong>YouTube</strong>
              <small>Visualizers</small>
            </div>
          </a>
          <a class="social" href="mailto:hello@example.com">
            <i class="fa-regular fa-envelope"></i>
            <div>
              <strong>Email</strong>
              <small>hello@example.com</small>
            </div>
          </a>
        </div>
      </div>
    </section>

    <section id="contact" class="container">
      <div class="card reveal">
        <h2 class="section-title">Contact</h2>
        <p class="muted">For bookings, custom beats, and collabs:</p>
        <div class="input-row">
          <a class="btn" href="mailto:hello@example.com?subject=Booking%20%2F%20Collab%20-%20lvghter">
            <i class="fa-regular fa-paper-plane"></i> Email me
          </a>
          <a class="btn secondary" href="https://wa.me/1234567890" target="_blank" rel="noopener">
            <i class="fa-brands fa-whatsapp"></i> WhatsApp
          </a>
        </div>
      </div>
    </section>
  </main>

  <footer class="container">
    <div>© <span id="year"></span> lvghter • Built with love and a phone</div>
  </footer>

  <script>
    // Config: put your featured Spotify links here (track/album/playlist).
    // You can paste any valid Spotify URL — the code uses oEmbed to fetch artwork/title/author.
    const featuredLinks = [
      // Replace these with your own
      "https://open.spotify.com/track/2takcwOaAZWiXQijPHIx7B",
      "https://open.spotify.com/track/3n3Ppam7vgaVa1iaRUc9Lp",
      "https://open.spotify.com/track/6habFhsOp2NvshLv26DqMb",
      "https://open.spotify.com/playlist/37i9dQZF1DXcBWIGoYBM5M",
      "https://open.spotify.com/album/382ObEPsp2rxGrnsizN5TX",
      "https://open.spotify.com/track/0eGsygTp906u18L0Oimnem"
    ];

    const dom = {
      navLinks: document.getElementById('navLinks'),
      hamburger: document.getElementById('hamburger'),
      playerWrap: document.getElementById('playerWrap'),
      iframe: document.getElementById('spotifyEmbed'),
      input: document.getElementById('spotifyInput'),
      loadBtn: document.getElementById('loadBtn'),
      prevBtn: document.getElementById('prevBtn'),
      nextBtn: document.getElementById('nextBtn'),
      tracksGrid: document.getElementById('tracksGrid'),
      npTitle: document.getElementById('npTitle'),
      npArtist: document.getElementById('npArtist'),
      overlay: document.querySelector('.dynamic-overlay'),
      swatch: document.getElementById('swatch'),
    };

    let currentIndex = 0;
    let trackMetaCache = new Map(); // url -> oembed meta
    let colorCache = new Map();     // thumbnail_url -> {r,g,b}

    // Basic helpers
    const clamp = (v, min, max) => Math.max(min, Math.min(max, v));
    const toRgbStr = ({r,g,b}, a) => a == null ? `rgb(${r}, ${g}, ${b})` : `rgba(${r}, ${g}, ${b}, ${a})`;
    const luminance = ({r,g,b}) => {
      // sRGB relative luminance
      const srgb = [r,g,b].map(v => {
        v /= 255; return v <= 0.03928 ? v/12.92 : Math.pow((v+0.055)/1.055, 2.4);
      });
      return 0.2126*srgb[0] + 0.7152*srgb[1] + 0.0722*srgb[2];
    };

    function rgbToHsl(r, g, b){
      r/=255; g/=255; b/=255;
      const max = Math.max(r,g,b), min = Math.min(r,g,b);
      let h,s; let l = (max+min)/2;
      if (max === min){ h = s = 0; }
      else{
        const d = max - min;
        s = l > .5 ? d/(2-max-min) : d/(max+min);
        switch(max){
          case r: h = (g-b)/d + (g<b ? 6:0); break;
          case g: h = (b-r)/d + 2; break;
          case b: h = (r-g)/d + 4; break;
        }
        h/=6;
      }
      return { h, s, l };
    }
    function hslToRgb(h, s, l){
      let r,g,b;
      if (s === 0){ r = g = b = l; }
      else {
        const hue2rgb = (p, q, t) => {
          if (t < 0) t += 1;
          if (t > 1) t -= 1;
          if (t < 1/6) return p + (q-p)*6*t;
          if (t < 1/2) return q;
          if (t < 2/3) return p + (q-p)*(2/3 - t)*6;
          return p;
        };
        const q = l < .5 ? l*(1+s) : l + s - l*s;
        const p = 2*l - q;
        r = hue2rgb(p, q, h + 1/3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1/3);
      }
      return { r: Math.round(r*255), g: Math.round(g*255), b: Math.round(b*255) };
    }
    function adjustLightness(rgb, delta){
      const hsl = rgbToHsl(rgb.r, rgb.g, rgb.b);
      const l = clamp(hsl.l + delta, 0, 1);
      return hslToRgb(hsl.h, hsl.s, l);
    }

    // Spotify oEmbed fetcher
    async function fetchOEmbed(url){
      if (trackMetaCache.has(url)) return trackMetaCache.get(url);
      const res = await fetch(`https://open.spotify.com/oembed?url=${encodeURIComponent(url)}`);
      if (!res.ok) throw new Error('Failed to fetch oEmbed');
      const data = await res.json();
      trackMetaCache.set(url, data);
      return data;
    }
    // Extract src from oEmbed's iframe HTML
    function extractSrcFromHtml(html){
      const div = document.createElement('div');
      div.innerHTML = html.trim();
      const iframe = div.querySelector('iframe');
      return iframe ? iframe.src : null;
    }

    // Average color from image URL using canvas
    function getAverageColorFromImageUrl(url){
      if (colorCache.has(url)) return Promise.resolve(colorCache.get(url));
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.crossOrigin = 'anonymous';
        // cache-bust param helps some CDNs with CORS caching modes
        img.src = url + (url.includes('?') ? '&' : '?') + 'cb=' + Date.now();
        img.onload = () => {
          try{
            const canvas = document.createElement('canvas');
            const w = canvas.width = 64;
            const h = canvas.height = 64;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, w, h);
            const data = ctx.getImageData(0, 0, w, h).data;
            let r=0,g=0,b=0,n=0;
            for (let i=0; i<data.length; i+=4){ r+=data[i]; g+=data[i+1]; b+=data[i+2]; n++; }
            const avg = { r: Math.round(r/n), g: Math.round(g/n), b: Math.round(b/n) };
            colorCache.set(url, avg);
            resolve(avg);
          } catch (e){
            reject(e);
          }
        };
        img.onerror = (e) => reject(e);
      });
    }

    // Apply color to theme (overlay + accents)
    function applyThemeColor(rgb){
      const accent = toRgbStr(rgb);
      const overlay = toRgbStr(rgb, 0.22);
      document.documentElement.style.setProperty('--accent', accent);
      document.documentElement.style.setProperty('--accent-overlay', overlay);
      dom.overlay.style.background = `radial-gradient(1200px 800px at 80% 20%, ${overlay}, transparent 65%)`;
      dom.swatch.style.background = accent;

      // Optional: tweak brand logo background for extra glow
      document.documentElement.style.setProperty('color-scheme', luminance(rgb) > 0.4 ? 'light' : 'dark');
    }

    // Update player to a given Spotify URL
    async function loadSpotify(url, {pushHistory = true} = {}){
      if (!url) return;
      dom.playerWrap.classList.add('loading');
      try{
        const meta = await fetchOEmbed(url);
        const embedSrc = extractSrcFromHtml(meta.html) || meta?.provider_url?.replace('open.', 'open./embed/') || null;

        if (embedSrc){
          dom.iframe.src = embedSrc;
        } else {
          // naive fallback: try to coerce open -> embed
          dom.iframe.src = url.replace('open.spotify.com/', 'open.spotify.com/embed/');
        }

        dom.npTitle.textContent = meta.title || '—';
        dom.npArtist.textContent = meta.author_name || '—';

        // Update accent color from thumbnail
        if (meta.thumbnail_url){
          try{
            const rgb = await getAverageColorFromImageUrl(meta.thumbnail_url);
            applyThemeColor(rgb);
          } catch (e){
            // fallback to purple if canvas taints
            applyThemeColor({r: 123, g: 44, b: 255});
          }
        }

        if (pushHistory){
          localStorage.setItem('lvghter:lastUrl', url);
          currentIndex = Math.max(0, featuredLinks.findIndex(v => v === url));
        }
      } catch (e){
        console.error(e);
        alert('Could not load that Spotify link. Try a track/album/playlist URL.');
      } finally {
        dom.playerWrap.classList.remove('loading');
      }
    }

    // Build featured tiles
    async function buildFeatured(){
      dom.tracksGrid.innerHTML = '';
      for (let i=0; i<featuredLinks.length; i++){
        const url = featuredLinks[i];
        const card = document.createElement('button');
        card.className = 'track';
        card.type = 'button';
        card.setAttribute('data-url', url);

        // skeleton UI
        card.innerHTML = `
          <img class="track__thumb" alt="" src="" />
          <div class="track__body">
            <div class="track__title">Loading…</div>
            <div class="track__meta muted">—</div>
          </div>
          <span class="pill">Play</span>
        `;
        dom.tracksGrid.appendChild(card);

        try{
          const meta = await fetchOEmbed(url);
          const thumb = card.querySelector('.track__thumb');
          thumb.src = meta.thumbnail_url;
          thumb.alt = meta.title ? `Cover art for ${meta.title}` : 'Cover art';

          card.querySelector('.track__title').textContent = (meta.title || 'Unknown').replace(/\s*-\s*song by.*/i, '');
          card.querySelector('.track__meta').textContent = meta.author_name || '—';

          card.addEventListener('click', () => loadSpotify(url));
        } catch (e){
          card.querySelector('.track__title').textContent = 'Couldn’t load';
          card.querySelector('.track__meta').textContent = '';
        }
      }
    }

    // Reveal on scroll
    function setupReveal(){
      const els = document.querySelectorAll('.reveal');
      const io = new IntersectionObserver((entries) => {
        entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('show'); });
      }, { threshold: 0.15 });
      els.forEach(el => io.observe(el));
    }

    // UI events
    function setupUi(){
      dom.hamburger.addEventListener('click', () => dom.navLinks.classList.toggle('open'));
      document.addEventListener('click', (e) => {
        if (!dom.navLinks.contains(e.target) && e.target !== dom.hamburger){ dom.navLinks.classList.remove('open'); }
      });

      dom.loadBtn.addEventListener('click', () => {
        const url = dom.input.value.trim();
        if (url) loadSpotify(url);
      });
      dom.input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') dom.loadBtn.click();
      });

      dom.prevBtn.addEventListener('click', () => {
        currentIndex = (currentIndex - 1 + featuredLinks.length) % featuredLinks.length;
        loadSpotify(featuredLinks[currentIndex]);
      });
      dom.nextBtn.addEventListener('click', () => {
        currentIndex = (currentIndex + 1) % featuredLinks.length;
        loadSpotify(featuredLinks[currentIndex]);
      });
    }

    // Init
    (async function init(){
      document.getElementById('year').textContent = new Date().getFullYear();
      setupReveal();
      setupUi();
      await buildFeatured();

      const last = localStorage.getItem('lvghter:lastUrl') || featuredLinks[0];
      const q = new URLSearchParams(location.search).get('spotify');
      const startUrl = q || last;
      loadSpotify(startUrl, { pushHistory: false });
    })();
  </script>
</body>
</html>
